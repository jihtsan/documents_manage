<!DOCTYPE html>
<html lang="en" xmlns:layout="http://www.ultraq.net.nz/web/thymeleaf/layout"
      layout:decorator="common/layout" xmlns:th="http://www.w3.org/1999/xhtml" xmlns="http://www.w3.org/1999/html">
<head>
    <meta charset="UTF-8"/>
    <title>AlphaZ</title>
    <link rel="stylesheet" href="resources/plugins/datatables/dataTables.bootstrap.css"/>
    <link rel="stylesheet" href="resources/plugins/bootstrap-select-1.12.4/css/bootstrap-select.min.css"/>
    <link rel="stylesheet" href="resources/plugins/sweetalert/sweetalert.css">
    <link rel="stylesheet" href="resources/plugins/datepicker/datepicker3.css">
    <link rel="stylesheet" href="resources/plugins/dist/css/selectize.default.css">
    <link rel="stylesheet" href="resources/plugins/viewer/demo/css/viewer.min.css">
    <link rel="stylesheet" href="resources/plugins/showloading/showLoading.css">

</head>
<body>
<div layout:fragment="content">
    <section class="content-header">
        <h1>
            查看/编辑盘货信息
            <small></small>
        </h1>
        <div class="dropdown" style="float: right;margin-top: -20px;margin-bottom: 5px;margin-right:5px;display: none;" id="toRetract">
            <button class="btn btn-default dropdown-toggle" type="button" id="dropdownMenu1" data-toggle="dropdown" aria-haspopup="true" aria-expanded="true">
                驳回
                <span class="caret"></span>
            </button>
            <ul class="dropdown-menu" aria-labelledby="dropdownMenu1" id="reject">
                <li data-toggle="modal" data-target="#myModalRetract" data-click="0" data-no = "0"><a href="javascript:;">入库</a></li>
            </ul>
        </div>
        <button class="btn btn-primary" style="float: right;margin-top: -20px;margin-bottom: 5px;margin-right:5px;display: none;" id="toSubmit">保存并提交</button>
        <button class="btn btn-primary" style="float: right;margin-top: -20px;margin-bottom: 5px;margin-right:5px;display: none;" id="toupdate">编辑</button>
        <button class="btn btn-primary" style="float: right;margin-top: -20px;margin-bottom: 5px;margin-right:5px;display: none;" id="tosave">保存</button>
        <!--<button class="btn btn-primary" style="float: right;margin-top: -20px;margin-bottom: 5px;margin-right:5px;display: none;" id="toDelete">撤回</button>-->
    </section>
    <section class="content">
        <img class='img_close' src='resources/img/clone.png' style="display: none">
        <div class="row">
            <div class="col-xs-12">
                <div class="box">
                    <div class="box-header">
                        <h3 class="box-title">入库信息</h3>
                    </div>
                    <!-- /.box-header -->
                    <div class="box-body">
                        <input th:value="${hid}" id="hid" type="hidden">
                        <input th:value="${pagemsg}" id="pagemsg" type="hidden">
                        <div class="row">
                            <div class="col-md-4 form-group">
                                <div class="input-group date">
                                    <div class="input-group-addon">
                                        <span>入库时间</span>
                                    </div>
                                    <input type="text" class="form-control pull-right disinp" placeholder="请选择入库时间" id="warehouseintime">
                                </div>
                            </div>
                            <div class="col-md-4 form-group">
                                <div class="input-group">
                                    <span class="input-group-addon">仓库代码</span>
                                    <div style="height: 34px;"><input id="warehouseid" placeholder="请填写仓库代码"></div>
                                </div>
                            </div>
                            <div class="col-md-4 form-group">
                                <div class="input-group">
                                    <span class="input-group-addon">客户</span>
                                    <div style="height: 34px;"><input id="clientname" placeholder="请填写客户"></div>
                                </div>
                            </div>
                            <div class="col-md-4 form-group">
                                <div class="input-group">
                                    <span class="input-group-addon">国家</span>
                                    <input type="text" class="form-control disinp" placeholder="请填写国家" id="country">
                                </div>
                            </div>
                            <div class="col-md-4 form-group">
                                <div class="input-group">
                                    <span class="input-group-addon">追溯码</span>
                                    <input type="text" class="form-control disinp" placeholder="请填写追溯码" id="logisticsNumber">
                                </div>
                            </div>
                            <div class="col-md-4 form-group">
                                <div class="input-group">
                                    <span class="input-group-addon">运输方式</span>
                                    <select id="gotype" class="form-control disinp">
                                        <option value="1">空运</option>
                                        <option value="2">海运</option>
                                        <option value="3">铁运</option>
                                    </select>
                                </div>
                            </div>
                            <div class="col-md-12 form-group">
                                <div class="input-group">
                                    <span class="input-group-addon">地址</span>
                                    <input type="text" class="form-control disinp" placeholder="请填写地址" id="address">
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="box-header">
                        <h3 class="box-title">箱子信息</h3>
                    </div>
                    <!-- /.box-header -->
                    <div class="box-body">
                        <div class="form-group">
                            <table class="table" id="tb0">
                                <thead>
                                <tr>
                                    <th style="text-align: center;">序号</th>
                                    <th style="text-align: center;">单箱重量（KG）</th>
                                    <th style="text-align: center;">单箱尺寸（CM）</th>
                                    <th style="text-align: center;">托盘号</th>
                                    <th style="text-align: center;">FBA号码</th>
                                    <th style="text-align: center;">地标</th>
                                </tr>
                                </thead>
                                <tbody>
                                </tbody>
                            </table>
                        </div>
                    </div>
                    <div class="box-header">
                        <h3 class="box-title">货物信息</h3>
                    </div>
                    <!-- /.box-header -->
                    <div class="box-body">
                        <div class="form-group" style="overflow-x: scroll;">
                            <table class="table" id="tb1"  style="table-layout:fixed;">
                                <thead>
                                <tr>
                                    <th style="text-align: center;width: 80px;">复制</th>
                                    <th style="text-align: center;width: 180px;">FBA号码</th>
                                    <th style="text-align: center;width: 80px;">箱子序号</th>
                                    <th style="text-align: center;width: 120px;">SKU号</th>
                                    <th style="text-align: center;width: 150px;">中文品名</th>
                                    <th style="text-align: center;width: 120px;">数量</th>
                                    <th style="text-align: center;width: 120px;">材质</th>
                                    <th style="text-align: center;width: 150px;">单个SKU重量（KG）</th>
                                    <th style="text-align: center;width: 200px;">单个SKU尺寸（CM）</th>
                                    <th style="text-align: center;width: 120px;">产品鉴定书</th>
                                    <th style="text-align: center;width: 130px;">是否有产品鉴定书</th>
                                    <th style="text-align: center;width: 120px;">照片</th>
                                    <th style="text-align: center;width: 80px;">照片数量</th>
                                </tr>
                                </thead>
                                <tbody>
                                </tbody>
                            </table>
                            <div class="col-md-12">
                                <div class="input-group" id="setbox1">
                                <span class="input-group-btn">
                                    <button class="btn btn-default" type="button" id="btndel1"><a><li class="fa fa-minus"></li></a></button>
                                </span>
                                    <input type="text" class="form-control" style="width:60px;text-align: center;" id="boxcount1" value="0" readonly>
                                    <span class="input-group-btn" style="float:left;">
                                    <button class="btn btn-default" type="button" id="btnadd1"><a><li class="fa fa-plus"></li></a></button>
                                </span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <!-- 模态框（Modal） -->
        <div class="modal fade" id="myModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true" data-id="">
            <div class="modal-dialog" style="margin-top:100px;width:800px;">
                <div class="modal-content">
                    <div class="modal-header">
                        <button type="button" class="close" data-dismiss="modal" aria-hidden="true">
                            &times;
                        </button>
                        <h4 class="modal-title" id="myModalLabel">
                            图片
                        </h4>
                    </div>
                    <div class="modal-body">
                        <form class="form-horizontal form-label-left" method="post"   enctype="multipart/form-data">
                            <h4 id="word"  align="center" style="display: none;">
                                您尚未上传图片或图片已遗失
                            </h4>
                            <div id="showpic" class="disinp1">
                            </div>
                            <div class="row" class="disinp1 form-control">
                                <div class="col-md-8"><input type="file" id="pic" name="pic" multiple="multiple"  accept="image/png,image/jpg,image/jpeg"></div>
                            </div>
                        </form>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-default" data-dismiss="modal">关闭
                        </button>
                        <button type="button" class="btn btn-primary disinp1" id="picup">
                            上传
                        </button>
                    </div>
                </div><!-- /.modal-content -->
            </div><!-- /.modal -->
        </div>


        <!-- 模态框（Modal） -->
        <div class="modal fade" id="myModal1" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true" data-id="">
            <div class="modal-dialog" style="margin-top:100px;">
                <div class="modal-content">
                    <div class="modal-header">
                        <button type="button" class="close" data-dismiss="modal" aria-hidden="true">
                            &times;
                        </button>
                        <h4 class="modal-title" id="myModalLabel1">
                            产品鉴定书
                        </h4>
                    </div>
                    <div class="modal-body">
                        <form class="form-horizontal form-label-left" method="post"  enctype="multipart/form-data">
                            <h4 id="word1"  align="center" style="display: none;">
                                您尚未上传产品鉴定书
                            </h4>
                            <div id="showpic1"  align="center" class="disinp1">
                                <img src="" style="width: 350px;height: 300px;" >
                            </div>
                            <div class="row" class="disinp1 form-control">
                                <div class="col-md-8"><input type="file" id="pic1" name="pic1" accept="image/png,image/jpg,image/jpeg"></div>
                            </div>
                        </form>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-default" data-dismiss="modal">关闭
                        </button>
                        <button type="button" class="btn btn-primary disinp1" id="picup1">
                            上传
                        </button>
                    </div>
                </div><!-- /.modal-content -->
            </div><!-- /.modal -->
        </div>

        <!-- Modal -->
        <div class="modal fade" id="myModalRetract" tabindex="-1" role="dialog" aria-labelledby="myModalLabel">
            <div class="modal-dialog" role="document">
                <div class="modal-content">
                    <div class="modal-header">
                        <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                        <h4 class="modal-title" id="myModalLabelRetract">驳回</h4>
                    </div>
                    <div class="modal-body">
                        <textarea id="rejectremark" style="width:100%;height:200px;"></textarea>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
                        <button type="button" class="btn btn-primary" onclick="confirm();">确认驳回</button>
                    </div>
                </div>
            </div>
        </div>
    </section>
    <script src="resources/plugins/page/page.js"></script>
    <script src="resources/plugins/sweetalert/sweetalert.min.js"></script>
    <script src="resources/plugins/bootstrap-select-1.12.4/js/bootstrap-select.min.js"></script>
    <script src="resources/js/ajaxfileupload.js" type="text/javascript" charset="utf-8"></script>
    <script src="resources/js/jquery.barcode.js" type="text/javascript" charset="utf-8"></script>
    <script src="resources/plugins/datepicker/bootstrap-datepicker.js"></script>
    <script src="resources/plugins/datepicker/locales/bootstrap-datepicker.zh-CN.js"></script>
    <script src="resources/plugins/dist/js/standalone/selectize.js"></script>
    <script src="resources/plugins/moment/moment.min.js"></script>
    <script src="resources/plugins/layer-v3.0.3/layer/layer.js"></script>
    <script src="resources/plugins/viewer/demo/js/viewer.min.js"></script>
    <script src="resources/plugins/showloading/jquery.showLoading.min.js"></script>
    <script th:inline="javascript">//引用
    var boxlist = [];
    var namelist = [];
    var isclick = 0;
    var controllist = [];
    var type = /*[[${type}]]*/;//从我的认领页面过来
    var cluid = /*[[${cluid}]]*/;//任务id
    var hid = /*[[${hid}]]*/;//货物id
    var cltype;
    $(function(){
        $.ajaxSetup({
            async: false
        });

        if(type ){
            $("#toupdate").show();
            $("#toRetract").show();
        }

        $("#reject li").on("click",function(){
            $(this).attr("data-click",1);
        })

        $("#setbox1").hide();
        $(".disinp").attr("disabled",true);
        $(".disinp1").hide();
        var id = $("#hid").val();
        $.ajax({
            url:'cargo/'+id+'/getcargologisticsbyid',
            type:"post",
            dataType:"json",
            success:function(data){
                console.log("箱子信息")
                console.log(data)
                var warehouseaddress = data.data.cl.warehouseaddress==null?"":data.data.cl.warehouseaddress;
                var country = data.data.cl.country==null?"":data.data.cl.country;
                var warehouseintime = (data.data.cl.warehouseintime == null||data.data.cl.warehouseintime == ""||data.data.cl.warehouseintime == 'null') ? "" : moment(data.data.cl.warehouseintime).format('YYYY-MM-DD HH:mm:ss');
                var logisticsNumber = data.data.cl.logisticsNumber==null?"":data.data.cl.logisticsNumber;
                var gotype = data.data.cl.gotype==null?"":data.data.cl.gotype;
                $("#address").val(warehouseaddress);
                $("#country").val(country);
                $("#warehouseintime").val(warehouseintime);
                $("#logisticsNumber").val(logisticsNumber);
                $("#boxcount").val(data.data.box.length);
                $("#gotype").val(gotype);

                var list1 = [data.data.cl.wid];
                setlist1(list1);
                var list2 = [data.data.cl.cid];
                list2.push(list2);
                setlist2(list2);

                $("#tb0 tbody").empty();
                boxlist = data.data.box;
                for(var i=0;i<data.data.box.length;i++){
                    var sort = data.data.box[i].sort==null?"":data.data.box[i].sort;
                    var weight = data.data.box[i].weight==null?"":data.data.box[i].weight;
                    var size1 = data.data.box[i].boxlength==null?"":data.data.box[i].boxlength;
                    var size2 = data.data.box[i].boxwidth==null?"":data.data.box[i].boxwidth;
                    var size3 = data.data.box[i].boxhigh==null?"":data.data.box[i].boxhigh;
                    var place = data.data.box[i].place==null?"":data.data.box[i].place;
                    var fba = data.data.box[i].fba==null?"":data.data.box[i].fba;
                    var addressmark = data.data.box[i].addressmark==null?"":data.data.box[i].addressmark;
                    $("#tb0 tbody").append('<tr>'+
                            '<td><input type="text" class="form-control" style="padding:0px;border: 0px;text-align: center;" placeholder="请填写序号" value="'+sort+'"></td>'+
                            '<td style="padding-right: 20px;"><input type="text" class="form-control" style="padding:0px;border: 0px;text-align: center;" placeholder="请填写单箱重量（KG）" value="'+weight+'"></td>'+
                            '<td><div class="row">' +
                            '<div class="col-md-3" style="padding:0px;"><input type="text" class="form-control" style="padding:0px;text-align: center;" value="'+size1+'"></div>' +
                            '<div class="col-md-1" style="padding:0px;" align="center"><span style="line-height: 34px;">*</span></div>' +
                            '<div class="col-md-3" style="padding:0px;"><input type="text" class="form-control" style="padding:0px;text-align: center;" value="'+size2+'"></div>' +
                            '<div class="col-md-1" style="padding:0px;" align="center"><span style="line-height: 34px;">*</span></div>' +
                            '<div class="col-md-3" style="padding:0px;"><input type="text" class="form-control" style="padding:0px;text-align: center;" value="'+size3+'"></div></div></td>'+
                            '<td><input type="text" class="form-control" style="padding:0px;border: 0px;text-align: center;" placeholder="请填写托盘号" value="'+place+'"></td>'+
                            '<td><input type="text" class="form-control" style="padding:0px;border: 0px;text-align: center;" placeholder="请填写FBA号码" value="'+fba+'"></td>'+
                            '<td><input type="text" class="form-control" style="padding:0px;border: 0px;text-align: center;" placeholder="请填写地标" value="'+addressmark+'"></td>'+
                            '</tr>');
                }
                $("#tb0 tbody tr td").find("input").attr("disabled",true);
            }
        });

        <!-- 获取所有的品名信息 -->
        $.ajax({
            url:"cargo/getcargoname",
            type:"post",
            dataType:"json",
            success:function(data){
                console.log("品名表")
                console.log(data)
                namelist = data.data;
                showh();
            }
        });

//        //撤回任
//        $("#toDelete").on("click",function(){
//            toDelete();
//        });

        //提交任务
        $("#toSubmit").on("click",function(){
            toSubmit();
        });
    });


    <!-- 根据id获取获取信息 -->
    function showh(){
        var hid = $("#hid").val();
        $.ajax({
            url:"cargo/"+hid+"/getcargobyid",
            type:"post",
            dataType:"json",
            success:function(data){
                console.log(data)
                $("#tb1 tbody").empty();
                for(var i=0;i<data.data.length;i++){
                    var id = data.data[i].id;
                    var boxsort = data.data[i].boxsort ==null?"":data.data[i].boxsort;
                    var count = data.data[i].count ==null?"":data.data[i].count;
                    var sku =data.data[i].sku ==null?"":data.data[i].sku;
                    var material =data.data[i].material ==null?"":data.data[i].material;
                    var weight =data.data[i].weight ==null?"":data.data[i].weight;
                    var fba =data.data[i].fba ==null?"":data.data[i].fba;
                    var needchemical = data.data[i].needchemical ==null?"":data.data[i].needchemical;
                    var val = "是";
                    if(needchemical==""){
                        val = "否";
                    }
                    var cargolength = data.data[i].cargolength ==null?"":data.data[i].cargolength;
                    var cargowidth = data.data[i].cargowidth ==null?"":data.data[i].cargowidth;
                    var cargohigh = data.data[i].cargohigh ==null?"":data.data[i].cargohigh;
                    var piccount = data.data[i].cargohigh ==null?0:data.data[i].cargohigh;
                    /*$.ajax({
                        url: "cargo/" + id + "/getcargopicbycargoid",
                        type: "post",
                        dataType: "json",
                        success: function (datas) {
                            var listt = [];
                            var val1 = 0;
                            for(var j=0;j<datas.data.length;j++){
                                listt[j] = datas.data[j].picid;
                                val1+=1;
                            }*/
                            $("#tb1 > tbody").append('<tr data-id="'+id+'">'+
                                    '<td><button class="btn" onclick="fuzhi('+i+');">复制</button></td>'+
                                    '<td><input type="text" class="form-control" style="padding:0px;border: 0px;text-align: center;" placeholder="请填写FBA号码" value="'+fba+'" onkeypress="pentfba('+i+')" onblur="pentfba1('+i+')"></td>'+
                                    '<td><input type="text" class="form-control boxNo" style="padding:0px;border: 0px;text-align: center;" placeholder="请填写箱子序号" value="'+boxsort+'" ></td>'+
                                    '<td data-id><input type="text" class="form-control" style="padding:0px;border: 0px;text-align: center;" placeholder="请填写SKU号" value="'+sku+'" onkeypress="pentsku('+i+')"></td>'+
                                    '<td><input class="pinming'+i+'" placeholder="请选择中文品名"></td>'+
                                    '<td><input type="text" class="form-control" style="padding:0px;border: 0px;text-align: center;" placeholder="请填写数量" value="'+count+'"></td>'+
                                    '<td><input type="text" class="form-control" style="padding:0px;border: 0px;text-align: center;" placeholder="请填写材质" value="'+material+'"></td>'+
                                    '<td style="padding-right: 20px;"><input type="text" class="form-control" style="padding:0px;border: 0px;text-align: center;" placeholder="请填写重量" value="'+weight+'"></td>'+
                                    '<td><div class="row">' +
                                    '<div class="col-md-3" style="padding:0px;"><input type="text" class="form-control" style="padding:0px;text-align: center;" value="'+cargolength+'"></div>' +
                                    '<div class="col-md-1" style="padding:0px;" align="center"><span style="line-height: 34px;">*</span></div>' +
                                    '<div class="col-md-3" style="padding:0px;"><input type="text" class="form-control" style="padding:0px;text-align: center;" value="'+cargowidth+'"></div>' +
                                    '<div class="col-md-1" style="padding:0px;" align="center"><span style="line-height: 34px;">*</span></div>' +
                                    '<div class="col-md-3" style="padding:0px;"><input type="text" class="form-control" style="padding:0px;text-align: center;" value="'+cargohigh+'"></div></div></td>'+
                                    '<td align="center"><button onclick="findpic('+i+');" type="button" class="btn">查看</button><input type="hidden" value="'+needchemical+'"></td>'+
                                    '<td><input type="text" class="form-control fileUpload" style="padding:0px;border: 0px;text-align: center;" placeholder="" value="'+val+'"></td>'+
                                    '<td align="center"><button onclick="aaa('+i+','+id+');"  type="button" class="btn">查看</button><input type="hidden" ><input type="hidden" ></td>'+//value="'+listt+'"
                                    '<td><input type="text" class="form-control picUpload" style="padding:0px;border: 0px;text-align: center;" placeholder="" value="'+piccount+'"></td>'+
                                    '</tr>');
                            var $select = $('.pinming'+i).selectize({
                                createOnBlur: true,
                                maxItems: 1,
                                valueField: 'id',
                                labelField: 'chinesename',
                                searchField: 'chinesename',
                                options: namelist,
                                create: false
                            });
                            var control = $select[0].selectize;
                            control.setValue([data.data[i].cargonameid]);
                            control.disable();
                            controllist.push(control);
                       // }
                   // });
                    $("#tb1 tbody tr").eq(i).find("td").eq(0).find("button").attr("disabled",true);
                }
                $("#boxcount1").val(data.data.length);
                $("#tb1 tbody tr td").find("input").attr("disabled",true);
                $("#tb1 tbody tr td").find("select").attr("disabled",true);

            }
        });
    }

    function setlist1(list1){
        $.ajax({
            url:"warehouseclient/warehouse",
            type:"get",
            data:{},
            dataType:"json",
            success:function(data){
                if(data.statusCode==0){
                    var list = [];
                    for (var i = 0; i < data.data.length; i++) {
                        var demolist = {"id": data.data[i].id, "name": data.data[i].warehouseid};
                        list.push(demolist);
                    }
                    var $select = $('#warehouseid').selectize({
                        createOnBlur: true,
                        maxItems: 1,
                        valueField: 'id',
                        labelField: 'name',
                        searchField: 'name',
                        options: list,
                        create: true
                    });
                    var control = $select[0].selectize;
                    control.setValue(list1);
                    control.disable();
                }
            }
        });
    }

    function setlist2(list2){
        $.ajax({
            url:"warehouseclient/client",
            type:"get",
            data:{},
            dataType:"json",
            success:function(data){
                if(data.statusCode==0){
                    var list = [];
                    for (var i = 0; i < data.data.length; i++) {
                        var demolist = {"id": data.data[i].id, "name": data.data[i].clientname};
                        list.push(demolist);
                    }
                    var $select = $('#clientname').selectize({
                        createOnBlur: true,
                        maxItems: 1,
                        valueField: 'id',
                        labelField: 'name',
                        searchField: 'name',
                        options: list,
                        create: true
                    });
                    var control = $select[0].selectize;
                    control.setValue(list2);
                    control.disable();
                }
            }
        });
    }

    $('#warehouseintime').datepicker({
        language:'zh-CN',
        format:'yyyy-mm-dd',
        autoclose: true
    });


    $("#toupdate").on("click",function(){
        $("#toSubmit").show();
        $("#toRetract").hide();
        $("#toupdate").hide();
        $("#tosave").show();
        $("#setbox1").show();
        $("#tb1 tbody tr td").find("input").attr("disabled",false);
        $("#tb1 tbody tr td").find("select").attr("disabled",false);
        $("#tb1 tbody tr td").find("button").attr("disabled",false);
        $(".disinp1").show();
        isclick = 1;
        for(var i=0;i<controllist.length;i++){
            controllist[i].enable();
        }
        $(".picUpload").attr("disabled",true);
        $(".fileUpload").attr("disabled",true);
        $(".boxNo").attr("disabled",true);
    });


    $("#btndel1").on("click",function(){
        var count = $("#boxcount1").val();
        if(count<=0){
            return;
        }
        var sum=-1;
        sum += parseInt(count);
        $("#boxcount1").val(sum);
        $("#tb1 >tbody> tr").eq(sum).remove();
    });

    $("#btnadd1").on("click",function(){
        var count = $("#boxcount1").val();
        var sum=1;
        sum += parseInt(count);
        $("#boxcount1").val(sum);
        $("#tb1 > tbody").append('<tr>'+
                '<td><button class="btn" onclick="fuzhi('+count+');">复制</button></td>'+
                '<td><input type="text" class="form-control" style="padding:0px;border: 0px;text-align: center;" placeholder="请填写FBA" onkeypress="pentfba('+count+')" onblur="pentfba1('+count+')"></td>'+
                '<td><input type="text" class="form-control picUpload" style="padding:0px;border: 0px;text-align: center;" placeholder="请填写箱子序号" disabled="disabled"></td>'+
                '<td data-id><input type="text" class="form-control" style="padding:0px;border: 0px;text-align: center;" placeholder="请填写SKU号" onkeypress="pentsku('+count+')"></td>'+
                '<td><input class="pinming'+count+'" placeholder="请选择中文品名"></td>'+
                '<td><input type="text" class="form-control" style="padding:0px;border: 0px;text-align: center;" placeholder="请填写数量"></td>'+
                '<td><input type="text" class="form-control" style="padding:0px;border: 0px;text-align: center;" placeholder="请填写材质"></td>'+
                '<td style="padding-right: 20px;"><input type="text" class="form-control" style="padding:0px;border: 0px;text-align: center;" placeholder="请填写重量"></td>'+
                '<td><div class="row">' +
                '<div class="col-md-3" style="padding:0px;"><input type="text" class="form-control" style="padding:0px;text-align: center;"></div>' +
                '<div class="col-md-1" style="padding:0px;" align="center"><span style="line-height: 34px;">*</span></div>' +
                '<div class="col-md-3" style="padding:0px;"><input type="text" class="form-control" style="padding:0px;text-align: center;"></div>' +
                '<div class="col-md-1" style="padding:0px;" align="center"><span style="line-height: 34px;">*</span></div>' +
                '<div class="col-md-3" style="padding:0px;"><input type="text" class="form-control" style="padding:0px;text-align: center;"></div></div></td>'+
                '<td align="center"><button onclick="findpic('+count+');"  type="button" class="btn">查看</button><input type="hidden"></td>'+
                '<td><input type="text" class="form-control fileUpload" style="padding:0px;border: 0px;text-align: center;" placeholder=""  disabled="true"></td>'+
                '<td align="center"><button onclick="aaa('+count+','+0+');" type="button" class="btn">查看</button><input type="hidden"></td>'+
                '<td><input type="text" class="form-control picUpload" style="padding:0px;border: 0px;text-align: center;" placeholder="" disabled="true"></td>'+
                '</tr>');

        $('.pinming'+count).selectize({
            createOnBlur: true,
            maxItems: 1,
            valueField: 'id',
            labelField: 'chinesename',
            searchField: 'chinesename',
            options: namelist,
            create: false
        });

    });

    $("#tosave").on("click",function(){
        var trList = $("#tb1 tbody").children("tr");
        var cargoModels = [];
        for (var i=0;i<trList.length;i++) {
            var id = trList.eq(i).attr("data-id");
            var tdArr = trList.eq(i).find("td");
            var fba = tdArr.eq(1).find('input').val();
            if(fba==null||fba==""){
                layer.msg("请输入fba");
                return
            }
            var count = tdArr.eq(5).find('input').val();
            var cnid = tdArr.eq(4).find(".pinming"+i).val();
            var chinesename = tdArr.eq(4).find(".pinming"+i+">.has-items > .item").text();
            if(cnid==chinesename){
                cnid = "";
            }
            var clid = $("#hid").val();
            var sku = tdArr.eq(3).find('input').val();
            var material = tdArr.eq(6).find('input').val();
            var weight = tdArr.eq(7).find('input').val();
            var cargolength = tdArr.eq(8).find('input').eq(0).val();
            var cargowidth = tdArr.eq(8).find('input').eq(1).val();
            var cargohigh = tdArr.eq(8).find('input').eq(2).val();
            var needchemical = tdArr.eq(9).find('input').val();
            var cargopic = tdArr.eq(11).find('input').val();
            var skuid = tdArr.eq(3).attr("data-id");
            var lista = [];
            if(cargopic.length>0){
                var a = cargopic.split(",");
                for(var j=0;j<a.length;j++){
                    lista[j] = a[j];
                }
            }
            var cargoModel = {
                id:id,
                clid:clid,
                sku:sku,
                count:count,
                cargolength:cargolength,
                cargowidth:cargowidth,
                cargohigh:cargohigh,
                weight:weight,
                cnid:cnid,
                chinesename:chinesename,
                material:material,
                needchemical:needchemical,
                fba:fba,
                cargopic:lista,
                lastcargoid:skuid,
                agreemessage : null,//1:提交  null 创建/保存
            };
            cargoModels.push(cargoModel);
        }
        console.log(JSON.stringify(cargoModels))
        $.ajax({
            url:"cargo/createcargo",
            type:"post",
            data:JSON.stringify(cargoModels),
            contentType: "application/json",
            success:function(data){
                swal({
                    title: "提示！",
                    text: "已保存任务！",
                    type: "success"
                }, function () {
                    location.href="toClaimList";
                });
            }
        });
    });




    function aaa(i,id){
        //第一个input放新增的货物的数据，第二个input放原先保存的数据
        $("#pic").val("");
        $("#myModal").modal();
        $("#myModal").attr("data-id",i);
        //$("#aa1").attr("src","file/aaa");
        $("#showpic").empty();
        if(id==0){
            var val = $("#tb1 tbody tr").eq(i).find("td").eq(11).find("input").eq(0).val();
            if(val.length<1&&isclick==0){
                $("#showpic").hide();
                $("#word").show();
                $("#myModal").modal();
                $("#myModal").attr("data-id",i);
                return;
            }else if(val.length<1&&isclick==1){
                $("#showpic").hide();
                $("#word").hide();
                $("#myModal").modal();
                $("#myModal").attr("data-id",i);
                return;
            }else if(val.length>=1&&isclick==1){
                $("#myModal").modal();
                $("#myModal").attr("data-id",i);
                $("#showpic").find("img").attr("src","file/showimg/"+val);
            }else if(val.length>=1&&isclick==0){
                $("#showpic").show();
                $("#word").hide();
                $("#myModal").modal();
                $("#myModal").attr("data-id",i);
                $("#showpic").find("img").attr("src","file/showimg/"+val);
            }
            var a = val.split(",");
            var v = 0;
            for (var j = 0; j < a.length; j++) {
                v+=1;
                $("#showpic").append("<div class='img_div' style='position:relative;width:110px;height:110px;display:inline-block;margin-right:5px;'>\n" +
                        //"<img class='img_close' src='resources/img/clone.png' style='position:absolute;right:0;top:0;' width='15'  onclick='deleteimg(" + a[j] + ",this)'>\n" +
                        "<a onclick='deleteimg(" + a[j] + ",this)' style='position:absolute;right:0;top:0;' width='15'>X</a>\n" +
                        "<img src='file/showimg/" + a[j] + "' class='img-thumbnail' >" +
                        "</div>"
                );
            }
            $("#tb1 tbody tr").eq(i).find("td").eq(12).find("input").val(v);
            var viewer = new Viewer(document.getElementById('myModal'), {
                //url: 'data-original'
                show: function (){
                    viewer.update();
                }
            });
        }else{
            $.ajax({
                url: "cargo/" + id + "/getcargopicbycargoid",
                type: "post",
                dataType: "json",
                success: function (datas) {
                    var listt = [];
                    for (var j = 0; j < datas.data.length; j++) {
                        listt[j] = datas.data[j].picid;
                    }
                    $("#tb1 tbody tr").eq(i).find("td").eq(11).find("input").eq(1).val(listt);

                    var val1 = $("#tb1 tbody tr").eq(i).find("td").eq(11).find("input").eq(1).val();
                    var val2 = $("#tb1 tbody tr").eq(i).find("td").eq(11).find("input").eq(0).val();
                    var val = val1;
                    val.concat(val2);
                    if(val.length<1&&isclick==0){
                        $("#showpic").hide();
                        $("#word").show();
                        $("#myModal").modal();
                        $("#myModal").attr("data-id",i);
                        return;
                    }else if(val.length<1&&isclick==1){
                        $("#showpic").hide();
                        $("#word").hide();
                        $("#myModal").modal();
                        $("#myModal").attr("data-id",i);
                        return;
                    }else if(val.length>=1&&isclick==1){
                        $("#myModal").modal();
                        $("#myModal").attr("data-id",i);
                        $("#showpic").find("img").attr("src","file/showimg/"+val);
                    }else if(val.length>=1&&isclick==0){
                        $("#showpic").show();
                        $("#word").hide();
                        $("#myModal").modal();
                        $("#myModal").attr("data-id",i);
                        $("#showpic").find("img").attr("src","file/showimg/"+val);
                    }
                    var a = val.split(",");
                    var v = 0;
                    for (var j = 0; j < a.length; j++) {
                        v+=1;
                        $("#showpic").append("<div class='img_div' style='position:relative;width:110px;height:110px;display:inline-block;margin-right:5px;'>\n" +
                                //"<img class='img_close' src='resources/img/clone.png' style='position:absolute;right:0;top:0;' width='15'  onclick='deleteimg(" + a[j] + ",this)'>\n" +
                                "<a onclick='deleteimg(" + a[j] + ",this)' style='position:absolute;right:0;top:0;' width='15'>X</a>\n" +
                                "<img src='file/showimg/" + a[j] + "' class='img-thumbnail' >" +
                                "</div>"
                        );
                    }
                    $("#tb1 tbody tr").eq(i).find("td").eq(12).find("input").val(v);
                    var viewer = new Viewer(document.getElementById('myModal'), {
                        //url: 'data-original'
                        show: function (){
                            viewer.update();
                        }
                    });

                }
            });
        }

    }

    $("#picup").on("click",function(){
        ajaxFileUpload();
    });

    $("#picup1").on("click",function(){
        ajaxFileUpload1();
        $('#myModal1').modal('hide')
    });

    function findpic(i){
        $("#pic1").val("");
        var val = $("#tb1 tbody tr").eq(i).find("td").eq(9).find("input").val();
        val = val==""?0:val;
        $("#showpic1").show();
        $("#word1").hide();
        if(val<1&&isclick==0){
            $("#showpic1").hide();
            $("#word1").show();
            $("#myModal1").modal();
            $("#myModal1").attr("data-id",i);
        }else if(val<1&&isclick==1){
            $("#showpic1").hide();
            $("#word1").hide();
            $("#myModal1").modal();
            $("#myModal1").attr("data-id",i);
        }else if(val>=1&&isclick==1){
            $("#myModal1").modal();
            $("#myModal1").attr("data-id",i);
            $("#showpic1").find("img").attr("src","file/showimg/"+val);
        }else if(val>=1&&isclick==0){
            $("#showpic1").show();
            $("#word1").hide();
            $("#myModal1").modal();
            $("#myModal1").attr("data-id",i);
            $("#showpic1").find("img").attr("src","file/showimg/"+val);
        }
        var viewer = new Viewer(document.getElementById('myModal1'), {
            //url: 'data-original'
            show: function (){
                viewer.update();
            }
        });
    }

    function ajaxFileUpload1() {  //ajaxFileUpload上传用户头像（我的简历中的基本信息模块）, <input type="file" id="Image" name="Image" onchange="ajaxFileUpload()" />成功
        $.ajaxFileUpload({
            url: 'file/uploadimage', //用于文件上传的服务器端请求地址
            type: "post",
            secureuri: false, //一般设置为false
            fileElementId: 'pic1', //文件上传空间的id属性  <input type="file" id="file1" name="file" />
            dataType: 'application/json', //返回值类型 一般设置为json
            success: function (data)  //服务器成功响应处理函数
            {
                var j=$("#myModal1").attr("data-id");
                $("#tb1 tbody tr").eq(j).find("td").eq(9).find("input").val(data.data[0].id)
                $("#tb1 tbody tr").eq(j).find("td").eq(10).find("input").val("是")
            },
            error: function (data, status, e)//服务器响应失败处理函数
            {
                alert(e);
            }
        });//end ajaxfile
    }


    var uploadimg = new Array();
    var imgconut = 0;


    function ajaxFileUpload() {  //ajaxFileUpload上传用户头像（我的简历中的基本信息模块）, <input type="file" id="Image" name="Image" onchange="ajaxFileUpload()" />成功
        $.ajaxFileUpload({
            url: 'file/uploadimage', //用于文件上传的服务器端请求地址
            type: "post",
            secureuri: false, //一般设置为false
            fileElementId: 'pic', //文件上传空间的id属性  <input type="file" id="file1" name="file" />
            dataType: 'application/json', //返回值类型 一般设置为json
            success: function (data)  //服务器成功响应处理函数
            {

                datas = data.data;
                if (data.statusCode == 0) {
                    var j=$("#myModal").attr("data-id");
                    var aaa = $("#tb1 tbody tr").eq(j).find("td").eq(11).find("input").eq(0).val();
                    var len = 0;
                    var a;
                    if(aaa.length>0){
                        a = aaa.split(",");
                        len = a.length;
                    }
                    var lista = new Array();
                    for (var i = 0; i <len; i++) {
                        lista[i] = a[i];
                    }
                    uploadimg = lista;
                    imgconut = len;
                    //var html = '<div class="docs-galley"><div class="docs-pictures clearfix">';
                   // $("#showpic").append('<ul class="docs-galley"><ul class="docs-pictures clearfix">');
                   // var htm = "";
                    for (var i = 0; i < datas.length; i++) {
                        uploadimg[imgconut] = datas[i].id;
                        imgconut++;
                        //$("#showpic").append("<div class='img_div' id='picchange' style='position:relative;width:150px;height:150px;display:inline-block;'>\n" +
                    /*"<img class='img_close' src='resources/img/clone.png' style='position:absolute;right:0;top:0;' width='15'  onclick='deleteimg(" + datas[i].id + ",this)'>\n" +*/
                        $("#showpic").append("<div class='img_div' style='position:relative;width:110px;height:110px;display:inline-block;margin-right:5px;'>\n" +
                                "<a onclick='deleteimg(" + datas[i].id + ",this)' style='position:absolute;right:0;top:0;' width='15'>X</a>\n" +
                        "<img src='file/showimg/" + datas[i].id + "' class='img-thumbnail' >" +
                        "</div>"
                        );
                        //htm+="<li style='width: 150px;'><img data-original='file/showimg/" + datas[i].id + "' src='file/showimg/" +datas[i].id + "' style='width: 150px;height: 150px;'><a style='margin-left:130px;'>X</a></li>";

                    }
                    $("#showpic").css({"display":"inline-block","overflow":"hidden"});
                    $("#tb1 tbody tr").eq(j).find("td").eq(11).find("input").eq(0).val(uploadimg);
                    $("#tb1 tbody tr").eq(j).find("td").eq(12).find("input").val(imgconut);
                    $("#pic").val("");
                    $("#tb1 tbody tr").eq(i).find("td").eq(12).find("input").val(v);
                }
            },
            error: function (data, status, e)//服务器响应失败处理函数
            {
                alert(e);
            }
        });//end ajaxfile
    }

    function deleteimg(id, obj) {
        var j=$("#myModal").attr("data-id");
        var aaa = $("#tb1 tbody tr").eq(j).find("td").eq(11).find("input").eq(0).val();
        var len = 0;
        var a;
        if(aaa.length>0){
            a = aaa.split(",");
            len = a.length;
        }
        var lista = new Array();
        for (var i = 0; i <len; i++) {
            lista[i] = a[i];
        }
        uploadimg = lista;
        imgconut = len;
        $(obj).closest('div').remove();
        for (var i = 0; i < uploadimg.length; i++) {
            if (id == uploadimg[i]) {
                uploadimg.splice(i, 1);
                imgconut--;
            }
        }
        $("#tb1 tbody tr").eq(j).find("td").eq(11).find("input").eq(0).val(uploadimg)
        $("#tb1 tbody tr").eq(j).find("td").eq(12).find("input").val(imgconut)
        $.ajax({
            url: 'file/' + id + '/', //用于文件上传的服务器端请求地址
            type: "delete",
            dataType: 'application/json', //返回值类型 一般设置为json
            success: function (data)  //服务器成功响应处理函数
            {
                if (data.statusCode == 0) {

                }
            }
        });//end ajaxfile
    }

    function fuzhi(counts){
        var cou = $("#boxcount1").val();
        var sum=1;
        sum += parseInt(cou);
        $("#boxcount1").val(sum);
        var tdArr = $("#tb1 tbody").children("tr").eq(counts).find("td");
        //var id = $("#tb1 tbody").children("tr").eq(counts).attr("data-id");
        var fba = tdArr.eq(1).find('input').val();
        var sort = tdArr.eq(2).find('input').val();
        var count = tdArr.eq(5).find('input').val();
        var cnid = tdArr.eq(4).find(".pinming"+counts).val();
        var chinesename = tdArr.eq(4).find(".pinming"+counts+">.has-items > .item").text();
        if(cnid==chinesename){
            cnid = "";
        }
        var sku = tdArr.eq(3).find('input').val();
        var material = tdArr.eq(6).find('input').val();
        var weight = tdArr.eq(7).find('input').val();
        var size1 = tdArr.eq(8).find('input').eq(0).val();
        var size2 = tdArr.eq(8).find('input').eq(1).val();
        var size3 = tdArr.eq(8).find('input').eq(2).val();
        var val1 =  tdArr.eq(9).find('input').val();
        var val2 =  tdArr.eq(10).find('input').val();
        var val3 =  tdArr.eq(11).find('input').val();
        var val4 =  tdArr.eq(12).find('input').val();
        var skuid = tdArr.eq(3).attr("data-id");
        $("#tb1 tbody").append('<tr>'+
                '<td><button class="btn" onclick="fuzhi('+cou+');">复制</button></td>'+
                '<td><input type="text" class="form-control" style="padding:0px;border: 0px;text-align: center;" placeholder="请填写FBA号码" value="'+fba+'" onkeypress="pentfba('+cou+')" onblur="pentfba1('+cou+')"></td>'+
                '<td><input type="text" disabled class="form-control" style="padding:0px;border: 0px;text-align: center;" placeholder="请填写箱子序号" value="'+sort+'"></td>'+
                '<td data-id="'+skuid+'"><input type="text" class="form-control" style="padding:0px;border: 0px;text-align: center;" placeholder="请填写SKU号" value="'+sku+'" onkeypress="pentsku('+cou+')"></td>'+
                '<td><input class="pinming'+cou+'" placeholder="请选择中文品名"></td>'+
                '<td><input type="text" class="form-control" style="padding:0px;border: 0px;text-align: center;" placeholder="请填写数量" value="'+count+'"></td>'+
                '<td><input type="text" class="form-control" style="padding:0px;border: 0px;text-align: center;" placeholder="请填写材质" value="'+material+'"></td>'+
                '<td style="padding-right: 20px;"><input type="text" class="form-control" style="padding:0px;border: 0px;text-align: center;" placeholder="请填写重量" value="'+weight+'"></td>'+
                '<td><div class="row">' +
                '<div class="col-md-3" style="padding:0px;"><input type="text" class="form-control" style="padding:0px;text-align: center;" value="'+size1+'"></div>' +
                '<div class="col-md-1" style="padding:0px;" align="center"><span style="line-height: 34px;">*</span></div>' +
                '<div class="col-md-3" style="padding:0px;"><input type="text" class="form-control" style="padding:0px;text-align: center;" value="'+size2+'"></div>' +
                '<div class="col-md-1" style="padding:0px;" align="center"><span style="line-height: 34px;">*</span></div>' +
                '<div class="col-md-3" style="padding:0px;"><input type="text" class="form-control" style="padding:0px;text-align: center;" value="'+size3+'"></div></div></td>'+
                '<td align="center"><button onclick="findpic('+cou+');" type="button" class="btn">查看</button><input type="hidden" value="'+val1+'"></td>'+
                '<td><input type="text" class="form-control" style="padding:0px;border: 0px;text-align: center;" placeholder="" value="'+val2+'"></td>'+
                '<td align="center"><button onclick="aaa('+cou+','+0+');"  type="button" class="btn">查看</button><input type="hidden" value="'+val3+'"></td>'+
                '<td><input type="text" class="form-control" style="padding:0px;border: 0px;text-align: center;" placeholder="" value="'+val4+'"></td>'+
                '</tr>');
        var $select = $('.pinming'+cou).selectize({
            createOnBlur: true,
            maxItems: 1,
            valueField: 'id',
            labelField: 'chinesename',
            searchField: 'chinesename',
            options: namelist,
            create: false
        });
        var control = $select[0].selectize;
        control.setValue([cnid]);
    }


    function pentsku(i){
        var sku = $("#tb1 tbody tr").eq(i).find("td").eq(3).find("input").val();
        $.ajax({
            url:"cargo/"+sku+"/getcargopicbysku",
            type:"post",
            dataType:"json",
            success:function(data){
                console.log("sku")
                console.log(data)
                if(data.statusCode==0){
                    var cargolength =  data.data.cargolength ==null?0:data.data.cargolength;
                    var cargowidth =  data.data.cargowidth ==null?0:data.data.cargowidth;
                    var cargohigh =  data.data.cargohigh ==null?0:data.data.cargohigh;
                    $("#tb1 tbody tr").eq(i).find("td").eq(3).attr("data-id",data.data.id);
                    $("#tb1 tbody tr").eq(i).find("td").eq(6).find("input").val(data.data.material);
                    $("#tb1 tbody tr").eq(i).find("td").eq(7).find("input").val(data.data.weight);
                    $("#tb1 tbody tr").eq(i).find("td").eq(8).find("input").eq(0).val(cargolength);
                    $("#tb1 tbody tr").eq(i).find("td").eq(8).find("input").eq(1).val(cargowidth);
                    $("#tb1 tbody tr").eq(i).find("td").eq(8).find("input").eq(2).val(cargohigh);
                    $("#tb1 tbody tr").eq(i).find("td").eq(9).find("input").val(data.data.needchemical);
                    $.ajax({
                        url: "cargo/" + data.data.id + "/getcargopicbycargoid",
                        type: "post",
                        dataType: "json",
                        success: function (datas) {
                            var listt = [];
                            for (var j = 0; j < datas.data.length; j++) {
                                listt[j] = datas.data[j].picid;
                            }
                            $("#tb1 tbody tr").eq(i).find("td").eq(11).find("input").eq(1).val(listt);
                            layer.msg("检索到，数据已填充");
                        }
                    })
                }
            }
        });
    }

    function pentfba(i){
        var fba = $("#tb1 tbody tr").eq(i).find("td").eq(1).find("input").val();
        $.ajax({
            url:"cargo/"+fba+"/getboxbyfba",
            type:"post",
            dataType:"json",
            success:function(data){
                console.log("fba")
                console.log(data)
                if(data.statusCode==0){
                    var sort = data.data.sort==null?"":data.data.sort;
                    $("#tb1 tbody tr").eq(i).find("td").eq(2).find("input").val(sort);
                }
            }
        });
    }

    function pentfba1(i){
        var fba = $("#tb1 tbody tr").eq(i).find("td").eq(1).find("input").val();
        $.ajax({
            url:"cargo/"+fba+"/getboxbyfba",
            type:"post",
            dataType:"json",
            success:function(data){
                console.log("fba")
                console.log(data)
                if(data.statusCode==0){
                    var sort = data.data.sort==null?"":data.data.sort;
                    $("#tb1 tbody tr").eq(i).find("td").eq(2).find("input").val(sort);
                }
            }
        });
    }

    //撤回任务
//    function toDelete(){
//        console.log(hid);
//        console.log(cluid);
//        $.ajax({
//            type: "post",
//            url: "claim/deleteclaim",
//            data: {
//                "clid" : hid,
//                "cluid" : cluid,
//            },
//            dataType: "json",
//            success: function (data) {
//                console.log(data)
//                if (data.statusCode ==1) {
//                    swal({
//                        title: "提示！",
//                        text: "已撤回任务！",
//                        type: "success"
//                    }, function () {
//                        location.href = "toClaimList";
//                    });
//                }
//            },
//            error: function (data) {
//                console.log(data)
//                swal("跳转失败！", data.message, "error");
//            }
//        })
//    }

    //驳回
    function confirm(){
        var num = 0;
        $("#reject li").each(function(){
            var clickType = $(this).attr("data-click");
            if(clickType == 1){
                num = 1;
                cltype = $(this).attr("data-no");
                $(this).attr("data-click","0");
            }
        })
        if(num == 0){
            return;
        }
        var rejectremark = $("#rejectremark").val();

        $.ajax({
            type: "post",
            url: "claim/rejectclamin",
            data: {
                "clid" : hid,
                "cluid" : cluid,
                "cltype" : cltype,
                "rejectremark" : rejectremark,
            },
            dataType: "json",
            success: function (data) {
                if (data.statusCode == 0) {
                    swal({
                        title: "提示！",
                        text: "已驳回任务！",
                        type: "success"
                    }, function () {
                        location.href="toClaimList";
                    });
                }
            },
            error: function (data) {
                swal("跳转失败！", data.message, "error");
            }
        })
    }

    function toSubmit(){
        var cargoModels = getCargoModels();
        $.ajax({
            url:"cargo/createcargo",
            type:"post",
            data:JSON.stringify(cargoModels),
            contentType: "application/json",
            success:function(data){
                swal({
                        title: "提示！",
                        text: "已提交任务！",
                        type: "success"
                    }, function () {
                        location.href="toClaimList";
                });
            }
        });
    }

    function getCargoModels(){
        var trList = $("#tb1 tbody").children("tr");
        var cargoModels = [];
        for (var i=0;i<trList.length;i++) {
            var id = trList.eq(i).attr("data-id");
            var tdArr = trList.eq(i).find("td");
            var fba = tdArr.eq(1).find('input').val();
            if(fba==null||fba==""){
                layer.msg("请输入fba");
                return
            }
            var count = tdArr.eq(5).find('input').val();
            var cnid = tdArr.eq(4).find(".pinming"+i).val();
            var chinesename = tdArr.eq(4).find(".pinming"+i+">.has-items > .item").text();
            if(cnid==chinesename){
                cnid = "";
            }
            var clid = $("#hid").val();
            var sku = tdArr.eq(3).find('input').val();
            var material = tdArr.eq(6).find('input').val();
            var weight = tdArr.eq(7).find('input').val();
            var cargolength = tdArr.eq(8).find('input').eq(0).val();
            var cargowidth = tdArr.eq(8).find('input').eq(1).val();
            var cargohigh = tdArr.eq(8).find('input').eq(2).val();
            var needchemical = tdArr.eq(9).find('input').val();
            var cargopic = tdArr.eq(11).find('input').eq(0).val();
            var skuid = tdArr.eq(3).attr("data-id");
            var lista = [];
            if(cargopic.length>0){
                var a = cargopic.split(",");
                for(var j=0;j<a.length;j++){
                    lista[j] = a[j];
                }
            }
            var cargoModel = {
                id:id,
                clid:clid,
                sku:sku,
                count:count,
                cargolength:cargolength,
                cargowidth:cargowidth,
                cargohigh:cargohigh,
                weight:weight,
                cnid:cnid,
                chinesename:chinesename,
                material:material,
                needchemical:needchemical,
                fba:fba,
                cargopic:lista,
                lastcargoid:skuid,
                agreemessage : 1,//1:提交  null 创建/保存
            };
            cargoModels.push(cargoModel);
        }
        return cargoModels;
    }
    </script>
</div>

</body>

</html>